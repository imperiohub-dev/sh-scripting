#!/usr/bin/env bash

# ==============================================================================
# @imperiohub/cli - NPM Package Wrapper
# ==============================================================================
# This wrapper script is the entry point when the package is installed via npm.
# It resolves the package installation directory and executes the main run.sh.
# ==============================================================================

set -e  # Exit on error

# Resolve the absolute path to this script
# This handles symlinks created by npm when installing globally
if [ -L "$0" ]; then
    # If this script is a symlink (which it will be with npm global install)
    SCRIPT_PATH="$(readlink -f "$0")"
else
    # If running directly from the package
    SCRIPT_PATH="$(cd "$(dirname "$0")" && pwd)/$(basename "$0")"
fi

# Get the package root directory (parent of bin/)
PACKAGE_DIR="$(cd "$(dirname "$SCRIPT_PATH")/.." && pwd)"

# Verify run.sh exists
if [ ! -f "$PACKAGE_DIR/run.sh" ]; then
    echo "Error: Could not find run.sh in package directory: $PACKAGE_DIR"
    echo "This might indicate a corrupted installation."
    echo "Try reinstalling: npm install -g @imperiohub/cli"
    exit 1
fi

# Execute the main launcher script
exec bash "$PACKAGE_DIR/run.sh" "$@"
